{
  "version": 3,
  "name": "BrokerX API Gateway",
  "port": 8080,
  "timeout": "3000ms",
  "cache_ttl": "3600s",
  "output_encoding": "json",
  "extra_config": {
    "router": {
        "auto_options": true,
        "return_error_msg": true
    },
    "security/cors": {
      "allow_origins": ["*"],
      "allow_methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS"],
      "allow_headers": ["Content-Type", "Authorization", "X-Requested-With"],
      "expose_headers": ["Content-Length"],
      "max_age": "12h",
      "allow_credentials": true
    }
  },
  "endpoints": [
    {
        "endpoint": "/api/token/",
        "method": "POST",
        "backend": [
            {
            "host": ["http://client-app:8001"],
            "url_pattern": "/api/token/"
            }
        ],
        "input_headers": [
          "Content-Type",
          "Content-Length",
          "Authorization",
          "Idempotency-Key"
        ]
    },
    {
        "endpoint": "/api/token/refresh/",
        "method": "POST",
        "backend": [
            {
            "host": ["http://client-app:8001"],
            "url_pattern": "/api/token/refresh/"
            }
        ],
        "input_headers": [
          "Content-Type",
          "Content-Length",
          "Authorization",
          "Idempotency-Key"
        ]
    },
    {
      "endpoint": "/client",
      "method": "POST",
      "backend": [
        {
          "host": ["http://client-app:8001"],
          "url_pattern": "/client",
          "extra_config": {
            "http": {
              "forward_request_body": true,
              "forward_response": true,
              "backend/http": {
              "return_error_code": true,
               "forward_request_headers": [
                "Authorization",
                "Content-Type",
                "Content-Length",
                "Idempotency-Key"
              ]
            },

              "read_all": true,
              "headers_to_pass": ["Content-Type"]
            }
          }
        }
      ],
      "input_headers": [
        "Content-Type",
        "Content-Length",
        "Authorization",
        "Idempotency-Key"
      ]
    },
    {
      "endpoint": "/client",
      "method": "GET",
      "backend": [
        {
          "host": ["http://client-app:8001"],
          "url_pattern": "/client",
          "extra_config": {
        "http": {
          "forward_request_headers": [
            "Authorization",
            "Content-Type",
            "Content-Length",
            "Idempotency-Key"
          ]
        }
      }
        }
      ],
      "input_headers": [
        "Content-Type",
        "Content-Length",
        "Authorization",
        "Idempotency-Key"
      ]
    },
    {
      "endpoint": "/passcode",
      "method": "POST",
      "backend": [
        {
          "host": ["http://client-app:8001"],
          "url_pattern": "/passcode",
          "extra_config": {
            "http": {
              "forward_request_body": true,
              "forward_response": true,
              "backend/http": {
              "return_error_code": true,
               "forward_request_headers": [
                "Authorization",
                "Content-Type",
                "Content-Length",
                "Idempotency-Key"
              ]
            },

              "read_all": true,
              "headers_to_pass": ["Content-Type"]
            }
          }
        }
      ],
      "input_headers": [
        "Content-Type",
        "Content-Length",
        "Authorization",
        "Idempotency-Key"
      ]
    },
    {
      "endpoint": "/passcode",
      "method": "PUT",
      "backend": [
        {
          "host": ["http://client-app:8001"],
          "url_pattern": "/passcode"
        }
      ],
      "input_headers": [
        "Content-Type",
        "Content-Length",
        "Authorization",
        "Idempotency-Key"
      ]
    },
    {
      "endpoint": "/wallet",
      "method": "GET",
      "input_headers": ["Authorization", "Content-Type"],
      "backend": [
        {
          "host": ["http://wallet-app:8003"],
          "url_pattern": "/wallet",
          "extra_config": {
        "http": {
          "forward_request_headers": [
            "Authorization",
            "Content-Type",
            "Content-Length",
            "Idempotency-Key"
          ]
        }
      }
        }
      ]
    },
    {
      "endpoint": "/wallet",
      "method": "POST",
      "input_headers": ["Authorization", "Content-Type"],
      "backend": [
        {
          "host": ["http://wallet-app:8003"],
          "url_pattern": "/wallet",
          "extra_config": {
        "http": {
          "forward_request_headers": [
            "Authorization",
            "Content-Type",
            "Content-Length",
            "Idempotency-Key"
          ]
        }
      }
        }
      ]
    },
    {
      "endpoint": "/order",
      "method": "POST",
      "backend": [
        {
          "host": ["http://order-app:8002"],
          "url_pattern": "/order",
          "extra_config": {
        "http": {
          "forward_request_headers": [
            "Authorization",
            "Content-Type",
            "Content-Length",
            "Idempotency-Key"
          ]
        }
      }
        }
      ]
    },
    {
      "endpoint": "/order",
      "method": "GET",
      "backend": [
        {
          "host": ["http://order-app:8002"],
          "url_pattern": "/order",
          "extra_config": {
        "http": {
          "forward_request_headers": [
            "Authorization",
            "Content-Type",
            "Content-Length",
            "Idempotency-Key"
          ]
        }
      }
        }
      ]
    }
  ]
}
